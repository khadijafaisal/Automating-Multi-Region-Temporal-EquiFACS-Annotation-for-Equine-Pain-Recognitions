!pip install --upgrade --force-reinstall numpy==1.26.4 --quiet
!pip install --upgrade --force-reinstall pandas==2.2.2 --quiet
!pip install --upgrade --force-reinstall pyarrow==21.0.0 --quiet
!pip install --upgrade --force-reinstall scipy==1.11.4 --quiet
!pip install --upgrade --force-reinstall matplotlib==3.7.2 --quiet
!pip install --upgrade --force-reinstall scikit-learn==1.3.2 --quiet

import sklearn
print(sklearn.__version__)

# CONFIGURATION
import os
import cv2
import numpy as np
import pandas as pd
import random
import shutil
from pathlib import Path
from tqdm import tqdm
from sklearn.model_selection import train_test_split
import matplotlib.pyplot as plt
import seaborn as sns
import torch

class Config:
    VIDEOS_PATH = "/kaggle/input/equine-dataset"
    NOSTRIL_LABELS = "/kaggle/input/dataset/nostril_raw"
    SAM_WEIGHTS = "/kaggle/input/sam2-file/sam2_l.pth"
    OUTPUT_ROOT = "/kaggle/working/nostril_balanced"
    
    CROP_DIR = Path(OUTPUT_ROOT) / "crops"
    RIFIED_DIR = Path(OUTPUT_ROOT) / "rified"
    FEATURE_DIR = Path(OUTPUT_ROOT) / "i3d_features"
    RESULTS_DIR = Path(OUTPUT_ROOT) / "results"
    
    for d in [CROP_DIR, Path(OUTPUT_ROOT)/"clips", RIFIED_DIR, FEATURE_DIR, RESULTS_DIR]:
        d.mkdir(parents=True, exist_ok=True)
    
    BACKGROUND_RATIO, MIN_NOSTRIL_SIZE, MAX_NOSTRIL_SIZE = 0.3, 20, 400
    TRAIN_RATIO, VAL_RATIO, RANDOM_SEED = 0.80, 0.20, 42
    DEVICE = "cuda" if torch.cuda.is_available() else "cpu"
    CLIP_LENGTH, BATCH_SIZE, NUM_EPOCHS, LEARNING_RATE = 16, 4, 50, 1e-3
    
    VIDEO_PAIN_LEVELS = {
        "S1_Video": 1, "S2_Video": 0, "S3_Video": 1, "S4_Video": 1,
        "S5_Video": 1, "S6_Video": 0, "S7_Video": 1, "S8_Video": 1,
        "S9_Video": 0, "S10_Video": 1, "S11_Video": 1, "S12_Video": 0,
    }
    CLASS_NAMES = ["Mild", "Moderate"]
    
    # Quality thresholds
    MIN_CONFIDENCE_THRESHOLD = 0.15  # Accept lower confidence during prep (YOLO will filter)
    
    # Visualization
    VISUALIZE_SAMPLES = True
    NUM_VIS_SAMPLES = 10

config = Config()
